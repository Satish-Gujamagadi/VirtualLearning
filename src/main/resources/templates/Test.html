<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mock Test</title>

<style>
body {
	font-family: 'Arial', sans-serif;
	margin: 0;
	padding: 0;
	box-sizing: border-box;
	background-color: #f4f4f4;
	display: flex;
	flex-direction: column;
	min-height: 100vh;
}

header {
	background-color: #333;
	color: white;
	padding: 1px;
	text-align: center;
}

nav {
	background-color: #555;
	padding: 1px;
	text-align: center;
}

nav a {
	color: white;
	text-decoration: none;
	padding: 10px;
	margin: 5px;
	display: inline-block;
}

nav-b {
	background-color: #555;
	padding: 1px;
	text-align: left;
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding-left: 20px;
	padding-right: 20px;
	color: #fff;
}

#timer {
	color: #ff5733;
	font-size: 18px;
	text-align: left;
}

main {
	padding: 20px;
	display: flex;
	justify-content: space-between;
}

#Quest {
	color: navy;
	font-size: 18px;
	text-align: right;
	padding: 10px;
	display: flex;
	flex-wrap: wrap;
	justify-content: flex-start;
}

/* Updated styles for the page numbers */
#Quest span {
	margin-right: 20px;
	cursor: pointer;
	display: inline-block;
	width: 25px;
	height: 25px;
	background-color: #3498db;
	color: #fff;
	text-align: center;
	border-radius: 50%;
	line-height: 25px;
}

footer {
	background-color: #333;
	color: white;
	text-align: center;
	padding: 10px;
	margin-top: auto;
}

.left-side {
	width: 70%;
}

.right-side {
	width: 28%;
	padding-left: 20px;
	box-sizing: border-box;
}

ul, li {
	list-style: none;
	margin: 0;
	padding: 0;
}
</style>

<!-- <script th:src="@{/js/timer.js}"></script> -->

<!-- Add this script block to include the JavaScript -->
<script th:inline="javascript">
    /*<![CDATA[*/
    // Check if the timer is already running in localStorage
    var timerIsRunning = localStorage.getItem('timerIsRunning') === 'true';

    // Initialize the timer
    if (timerIsRunning) {
        resumeTimer();
    } else {
        startTimer();
    }

    function startTimer() {
        var spdVal = 1;
        var cntDown = localStorage.getItem("countdownTime") || 60 * 60 * spdVal + 7;

        var timer = setInterval(function () {
            var mn, sc, ms;
            cntDown--;
            if (cntDown < 0) {
                clearInterval(timer);
                alert("Time's up!");
                // You can add logic to check the answers here
                return false;
            }
            mn = Math.floor((cntDown / spdVal) / 60);
            mn = (mn < 10 ? '0' + mn : mn);
            sc = Math.floor((cntDown / spdVal) % 60);
            sc = (sc < 10 ? '0' + sc : sc);
            ms = Math.floor(cntDown % spdVal);
            ms = (ms < 10 ? '0' + ms : ms);
            var result = mn + ':' + sc;
            document.getElementById('timer').innerHTML = result;

            // Store the countdown time in localStorage
            localStorage.setItem("countdownTime", cntDown.toString());

        }, spdVal * 1000); // Convert seconds to milliseconds

        // Set the timer state in localStorage
        localStorage.setItem('timerIsRunning', 'true');
    }

    function resumeTimer() {
        var spdVal = 1;
        var cntDown = localStorage.getItem("countdownTime") || 60 * 60 * spdVal + 7;

        var timer = setInterval(function () {
            var mn, sc, ms;
            cntDown--;
            if (cntDown < 0) {
                clearInterval(timer);
                alert("Time's up!");
                // You can add logic to check the answers here
                return false;
            }
            mn = Math.floor((cntDown / spdVal) / 60);
            mn = (mn < 10 ? '0' + mn : mn);
            sc = Math.floor((cntDown / spdVal) % 60);
            sc = (sc < 10 ? '0' + sc : sc);
            ms = Math.floor(cntDown % spdVal);
            ms = (ms < 10 ? '0' + ms : ms);
            var result = mn + ':' + sc;
            document.getElementById('timer').innerHTML = result;

            // Store the countdown time in localStorage
            localStorage.setItem("countdownTime", cntDown.toString());

        }, spdVal * 1000); // Convert seconds to milliseconds
    }
    /*]]>*/
</script>

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->


</head>

<body onload="startTimer()">

	<header>
		<h1>Virtual Learning Platform</h1>

		<div th:if="${logout}" id="logout-message">
			<p th:text=" ${logout} + ' !'"></p>
		</div>
	</header>

	<nav-b>
	<nav>
		<h1>Mock Test</h1>
	</nav>
	<h3>
		Timer:
		<div id="timer">60:00</div>
	</h3>
	</nav-b>

	<!-- Display the current question -->
	<main>
		<div class="left-side" th:if="${questions.hasContent()}">
			<form>
				<ul th:each="question, questionIndex : ${questions.content}">
					<li>
						<p th:text="${questionIndex.index + 1 + '. ' + question.question}"></p>
						<ul>
							<li><input type="radio"
								th:id="'option1_' + ${questionIndex.index}"
								name="'question_' + ${questionIndex.index}" /> <label
								th:for="'option1_' + ${questionIndex.index}"
								th:text="${question.option1}"></label></li>
							<li><input type="radio"
								th:id="'option2_' + ${questionIndex.index}"
								name="'question_' + ${questionIndex.index}" /> <label
								th:for="'option2_' + ${questionIndex.index}"
								th:text="${question.option2}"></label></li>
							<li><input type="radio"
								th:id="'option3_' + ${questionIndex.index}"
								name="'question_' + ${questionIndex.index}" /> <label
								th:for="'option3_' + ${questionIndex.index}"
								th:text="${question.option3}"></label></li>
							<li><input type="radio"
								th:id="'option4_' + ${questionIndex.index}"
								name="'question_' + ${questionIndex.index}" /> <label
								th:for="'option4_' + ${questionIndex.index}"
								th:text="${question.option4}"></label></li>
						</ul>
					</li>
				</ul>
				<h2>
					<button type="submit">Submit</button>
				</h2>
			</form>
		</div>

		<!-- Right side for "Select Question" -->
		<div class="right-side">
			<h3>
				<label> Select Question:</label>
			</h3>
			<div id="Quest">
				<div
					th:each="page, pageIndex : ${#numbers.sequence(1, questions.totalPages)}">
					<span class="page-number" th:text="${page}"
						th:onclick="'selectPage(' + ${page} + ')'"></span>
				</div>
			</div>
		</div>
	</main>

	<!-- Display page information -->
	<div>
		<p
			th:text="'Page ' + ${questions.number + 1} + ' of ' + ${questions.totalPages}"></p>

		<script th:inline="javascript">
			/*<![CDATA[*/
			function selectPage(page) {
				// Update the URL with the selected page
				var url = new URL(window.location.href);
				url.searchParams.set('page', page - 1);
				window.history.replaceState({}, document.title, url);

				// Do something else when a page number is selected, e.g., highlight the selected page.
				alert('Selected page: ' + page);
			}
			/*]]>*/
		</script>
	</div>

	<!-- Add a button to go to the previous page -->
	<div id="footerButton">
		<button th:if="${questions.hasPrevious()}" onclick="previousPage()">Previous
			Page</button>

		<!-- Add a button to go to the next page -->
		<button th:if="${questions.hasNext()}" onclick="nextPage()">Next
			Page</button>
	</div>

	<!-- ######################## next & Previous Buttons Script ######################## -->

	<!-- Add a script to handle navigation -->
	<script th:inline="javascript">
		/*<![CDATA[*/
		function navigateToPage(page) {
			// Construct the URL for the specified page
			var url = new URL(window.location.href);
			url.searchParams.set('page', page);

			// Navigate to the new URL
			window.location.href = url.href;
		}

		function previousPage() {
			// Get the current page number
			var currentPage = /*[[${questions.number}]]*/0;

			// Calculate the previous page number
			var previousPage = currentPage - 1;

			// Navigate to the previous page
			navigateToPage(previousPage);
		}

		function nextPage() {
			// Get the current page number
			var currentPage = /*[[${questions.number}]]*/0;

			// Calculate the next page number
			var nextPage = currentPage + 1;

			// Navigate to the next page
			navigateToPage(nextPage);
		}
		/*]]>*/
	</script>

	<!--############# Footer Section ###############-->
	<footer> &copy; 2023 Virtual Learning </footer>

	<!-- ##################################### -->
</body>
</html>
